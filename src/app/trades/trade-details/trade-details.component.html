<div class="container py-5" *ngIf="tradeData">

    <div class="mt-4 p-5 bg-primary text-white rounded row">
        <div class="col-md-6">
            <h1>{{tradeData.denomination}}</h1>
            Sigle référence : {{tradeData.sigle}}.
                <br>Nombre de compétences à valider : {{tradeData.competences.length}}.
                <br>Durée max de la formation : {{firstValuesSum}} heures
                <p  class="rounded bg-dark p-2 mt-2 small">Pour vérification du rôle récupéré : {{userRole}}</p>
        </div>
        <!-- il faut différencier le cas d'un userRole=none...  -->
        <div *ngIf="userRole==='none' else switch" class="col-md-6 text-white mt-md-5">
            <p>Afin de commencer un QCM, merci de <a [routerLink]="[
                '/login']" class="text-white fw-bold">vous authentifier</a> ou <a [routerLink]="[
                '/register']"  class="text-white fw-bold">vous enregister</a></p>

        </div>
        <!-- ...des autres cas -->
        <ng-template #switch>
            <div class="col-md-6 fs-3 text-white mt-md-5">
                <a [routerLink]="[
                '/quizz/',
                this.tradeData.sigle,
                studentData?.['quizz_'+this.tradeData.sigle]?((studentData?.['quizz_'+this.tradeData.sigle]?.lastIndexQuestion) + 1 | number):0,
                ((studentData?.['quizz_'+this.tradeData.sigle]?.scoreCounter || 0 | number)),
                studentData?.['quizz_'+this.tradeData.sigle] ? true : false,
                studentData?.id ? studentId : ''
              ]" class="text-decoration-none text-dark">
                    <!-- ---------------- -->
                    <ng-container *ngIf="studentData && userRole!=='editor'">
                        <!-- ScoreCounter : {{ studentData['quizz_'+this.tradeData.sigle].scoreCounter | json }} -->
                        <!-- pour switcher d'un intitulé à un autre selon que studentData.tradeEvaluated && studentData.tradeEvaluated==trade.sigle -->

                        <div class="d-flex justify-content-md-end" *ngIf="hasStartedEvaluation==false, else none">
                            <button class="btn btn-transparent"><i class="bi bi-clock"></i>
                                Démarrer votre évaluation</button>
                        </div>

                        <ng-template #none>
                            <div class="d-flex justify-content-md-end"
                                *ngIf="!studentData['quizz_'+this.tradeData.sigle].fullResults"><button
                                    class="btn btn-transparent"><i class="bi bi-clock-history"></i>
                                    <!-- Reprendre à la question {{studentData.lastIndexQuestion+1}}</button></div> -->
                                    Poursuivre</button></div>

                            <div class="d-flex justify-content-md-end"
                                *ngIf="studentData['quizz_'+this.tradeData.sigle].fullResults"><button
                                    class="btn btn-transparent"><i class="bi bi-check-square-fill"></i>
                                    Votre évaluation est terminée</button>
                            </div>
                        </ng-template>

                    </ng-container>

                    <!-- ---------------- -->
                </a>
            </div>
        </ng-template>

    </div>
    <!-- 
    {{tradeData | json}} -->

    <div class="mt-4 p-5 bg-light rounded">
        <!-- <div [ngClass]="{'col-lg-6':imageUrl!=''}" *ngIf="imageUrl && imageUrl!=''" >
            <img class="img-fluid" [src]="imageUrl">
        </div> -->


    <img class="cover rounded mb-5" [src]="imageUrl" *ngIf="imageUrl">


        <ng-container *ngIf="tradeData.description">
            <!-- si on utilise l'éditeur de texte -->
            <!-- <div [ngClass]="{'col-lg-6 mt-3':imageUrl!=''}" [innerHTML]="sanitizer.bypassSecurityTrustHtml(tradeData.description)">
            </div> -->
            <div [innerHTML]="sanitizer.bypassSecurityTrustHtml(tradeData.description)">
            </div>
            <!-- et pour avoir accès au lien d'édition -->
            <div *ngIf="userRole=='editor'" class="d-flex justify-content-end text mt-3">
                <button class="btn btn-primary">
                    <a class="text-white" [routerLink]="['/admin/updateDescription', tradeData.sigle, userRole]">
                        <i class="bi bi-pencil-square"></i>
                        Editer</a>
                </button>
                <!-- pour images si option avec simple redirection vers le formulaire dédié -->
                <!-- <button class="btn btn-primary ms-2">
                    <a class="text-white" [routerLink]="['/admin/updateTradeImage', tradeData.sigle]">
                        <i class="bi bi-image"></i>
                        Image</a>
                </button> -->
                <!-- option édition avec modale -->
                <button class="btn btn-primary ms-2 text-light" data-bs-toggle="modal" data-bs-target="#myModal">
                            <i class="bi  bi-image"></i>Image
                        </button>
                        <div class="modal" id="myModal">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title ms-auto">Image de couverture pour {{tradeData.sigle}}</h4>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <app-cover-image class="modal-body" [tradeId]="tradeData.sigle"></app-cover-image>
                                </div>
                            </div>
                        </div>
                <!-- fin de l'option édition avec modale -->

            </div>
        </ng-container>
    </div>

    <div class="mt-4 p-5 bg-primary text-white rounded">
        <ng-container *ngIf="tradeData.competences">
            <p *ngFor="let cp of tradeData.competences, let index=index">
                <span class="fw-bold">CP{{index+1}} : </span> {{cp}}
            </p>
        </ng-container>
        
    </div>



</div>