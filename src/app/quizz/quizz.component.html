<div class="container py-5 text-center">
    <h3>Quizz pour métier {{trade}}</h3>
    <h4 class="fs-6">Id de l'étudiant récupéré : {{studentId}}</h4>
    <div class="alert alert-danger">fullOptScoring récupéré par le parent{{fullOptScoringTrue}} à comparer à
        totalAnswersAvailable {{totalAnswersAvailable}} sur la base de {{indexQuestion}}</div>
    <p class="alert bg-dark text-white text-smaller">Tableau des durées depuis la vue format json: {{durations | json}}
    </p>
    <!-- <div class="alert bg-light mt-3 mb-4">
        Placeat dolorem eveniet beatae culpa molestias numquam quis ex quidem animi fugit consequuntur voluptatibus quo corrupti nobis ab, laboriosam minima commodi nostrum?
    </div> -->
    <!-- partie visuelle similaire à la vue de détail des administrateurs (en mode aperçu) qui ici va devenir réactive -->
    <!-- {{questions[0] | json}} -->
    <div class="alert bg-info text-white text-smaller">Cumul des points récupérés par le parent : {{scoreCounter}}</div>
    <!-- etat des compétences en base -->
    <!-- <p>{{indexQuestion}}</p> -->
    <div class="alert bg-info text-white text-smaller"
        *ngIf="!hasStartedEvaluation && dataStudent && !studentCompetences">
        StudentCompetences à rattacher en base : {{studentCompetences | json}}</div>
    <!-- ne  pas supprimer les lignes ci-dessous : impeccables -->
    <div *ngIf="hasStartedEvaluation && dataStudent && studentCompetences" class="mb-3">
        <div *ngFor="let objet of studentCompetences">
            <div *ngFor="let item of objet | keyvalue"><span class="fw-bold">Points affectés à {{ item.key }}:</span> {{
                item.value }}
                PNTS</div>
        </div>
    </div>

    <!-- a commencé l'évaluation -->
    <div class="alert bg-info text-white text-smaller">hasStartedEvaluation : {{hasStartedEvaluation}}</div>

    <!-- on veut juste la première de la liste initiale -->
    <div *ngIf="questions[indexQuestion]">
        <!-- <div *ngFor="let q of questions"> -->
        <div>
            <app-details (resetCounter)="resetChildCounter()" [q]="questions[indexQuestion]"
                [questionsMedias]="questionsMedias" [responsesMedias]="responsesMedias"
                (hasBeenClicked)="answered($event)" [fullGoodAnswersClicked]="fullGoodAnswersClicked"
                [fullAnswersClicked]="fullAnswersClicked" [totalAnswersAvailable]="totalAnswersAvailable"
                [fullOptScoringTrue]="fullOptScoringTrue" (hasBeenUpdated)="updated($event)" [counter]="scoreCounter"
                [studentCompetences]="studentCompetences"></app-details>
        </div>
    </div>
    <!-- </div> -->

    <!-- le < 3 ne vallait qu'en mode test !!!!!!!! -->
    <!-- <button *ngIf="indexQuestion<3; else elseBlock" class="btn btn-primary m-auto"
        [disabled]="isCompleted==false || indexQuestion==3" (click)="next(indexQuestion)">Question suivante</button> -->
    <button *ngIf="indexQuestion<questions.length; else elseBlock" class="btn btn-primary m-auto"
        [disabled]="isCompleted==false || fullAnswersClicked===0 || indexQuestion==questions.length"
        (click)="next(indexQuestion,  questions[indexQuestion].competence)">Question suivante</button>
    <ng-template #elseBlock> <button class="btn btn-primary m-md-auto"><i class="bi bi-check text-light"></i>QCM
            d'accroche terminé !</button>
    </ng-template>

    <hr>

    <!-- tableau des dénominateurs propres à chaque compétence -->
    <div *ngIf="denominatorsCompetences && denominatorsCompetences.length>0" class="mt-3">
        {{denominatorsCompetences | json}}
        <div *ngFor="let denominator of denominatorsCompetences">
            <div *ngFor="let item of denominator | keyvalue">
                <span class="fw-bold">Réel dénominateur pour {{ item.key }}
                </span> {{ item.value }}
            </div>
        </div>
    </div>

    <hr>

    <!-- partie positionnement principale mais sera amenée à disparaitre -->
    <button (click)="setLevel()" class="btn bg-warning m-md-auto text-light  fs-4"><i
            class="me-3 bi bi-bar-chart-steps text-light"></i>Votre positionnement (disparaitra)</button>

    <div *ngIf="realEvaluations && realEvaluations.length > 0" class="mt-3">
        <div *ngFor="let result of realEvaluations">
            <div *ngFor="let key of result | keys">
                <span class="fw-bold">Note pour <app-tooltip [text]="key" [info]="moreInfo"
                        (mouseenter)="updateMoreInfo(key)"></app-tooltip></span>
                {{ result[key] | number:'1.1-1' }} /20
            </div>
        </div>
    </div>
    <!-- fourchette -->
    <div *ngIf="levelsArray && levelsArray.length>0">
        <div *ngFor="let objet of levelsArray">
            <div *ngFor="let item of objet | keyvalue"> <span class="fw-bold">( {{ item.key }}: </span>fourchette {{
                item.value }}) </div>
        </div>
    </div>

    <hr>
    <!-- fin -->

    <button data-bs-toggle="modal" data-bs-target="#myModal" (click)="generateFullResults()"
        class="btn bg-warning m-md-auto text-light fs-4"><i class="me-3 bi bi-bar-chart-steps text-light"></i>Votre
        devis</button>
    <!-- <div *ngIf="levelsArray && levelsArray.length>0">{{levelsArray | json}}</div> -->
    <div class="modal fade" id="myModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-light position-relative">
                    <h3>Votre devis personnalisé</h3>
                    <!-- <button type="button" class="btn-close position-absolute end-5" data-bs-dismiss="modal"></button> -->
                </div>
                <!-- contenu de la modale -->

                <div class="modal-body">
                    <p class="alert bg-primary text-light p-2 m-3 fw-light ">Bravo, vous êtes parvenu au terme du
                        questionnaire. En fonction des résultats enregistrés, nous sommes en mesure de vous fournir une
                        estimation détaillée en coût et durée.</p>

                    <div *ngIf="fullResults && fullResults.length>0" class="mt-3">
                        <div *ngFor="let item of durationsByLevels | keyvalue">
                            <span class="text-success">Durée de la formation pour {{ item.key }}:</span> {{ item.value
                            }} heures
                        </div>
                        <div *ngFor="let item of estimatedCPCost | keyvalue">
                            <span class="text-success">Coût individualisé pour {{ item.key | slice:16 }}:</span> {{
                            item.value }}
                            euros
                        </div>
                        <hr>
                        <span class="fw-bold">Coût total de la formation {{ totalCost }} euros</span>
                    </div>
                </div>

                <div class="modal-footer bg-light justify-content-center">
                    <button type="button" class="btn bg-dark text-light" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary">Tous les résulats sur votre compte</button>
                </div>
            </div>
        </div>
    </div>


</div>